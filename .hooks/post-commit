#!/bin/bash

# Get the current branch name
current_branch=$(git symbolic-ref --short HEAD)

# Check if we're on the main branch
if [ "$current_branch" = "main" ]; then
  echo "Post-commit hook: Detected commit to main branch"
  
  # Define the source and destination directories
  repo_dir=$(git rev-parse --show-toplevel)
  dest_dir="$HOME/.config/fabric/patterns"
  
  # Create the destination directory if it doesn't exist
  mkdir -p "$dest_dir"
  
  # Find all directories in the repository (excluding .git and .hooks)
  for dir in $(find "$repo_dir" -maxdepth 1 -type d | grep -v "^$repo_dir$" | grep -v "^$repo_dir/.git$" | grep -v "^$repo_dir/.hooks$"); do
    dir_name=$(basename "$dir")
    echo "Copying directory: $dir_name"
    
    # Use rsync to copy the directory to the destination
    rsync -a "$dir/" "$dest_dir/$dir_name/"
  done
  
  echo "Post-commit hook: Successfully copied patterns to $dest_dir"
fi
